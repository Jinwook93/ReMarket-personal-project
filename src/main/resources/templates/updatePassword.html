<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>비밀번호 찾기</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 0;
            padding: 0;
        }
        form {
            max-width: 400px;
            margin: 50px auto;
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        input[type="text"], input[type="email"] {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        button {
            width: 100%;
            padding: 10px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>
    <div th:replace="~{header.html}"></div>
<!--     <form action="/goupdatepassword" method="POST"> -->
        <h2>비밀번호 수정</h2>
    <label for="password">새 비밀번호</label>
        <input type="password" id="password" name="password" required><br>
        
        <!-- 비밀번호 확인 -->
        <label for="password_check">새 비밀번호 확인</label>
        <input type="password" id="password_check" name="password_check"  required><br>

        <button type=button id="updatePasswordButton">비밀번호 찾기</button>
<!--     </form> -->

 	<div id="updatepasswordModal" style="display:none; position:fixed; top:50%; left:50%; 
     transform:translate(-50%, -50%); background:white; border:1px solid #ccc;  
     border-radius:10px; padding:20px; box-shadow:0 0 10px rgba(0,0,0,0.3); z-index:1000;"> 
    <p id="modalText">비밀번호 검색 결과가 없습니다.</p>
    <button onclick="closeModal()">닫기</button>
</div>

        <div th:replace="~{footer.html}"></div>
        
        
        
        
           <script>
           
          
        const updatepasswordModal = document.getElementById("updatepasswordModal");
        const modalText = document.getElementById("modalText");

        // 모달 닫기
        function closeModal() {
        	
            updatepasswordModal.style.display = "none";
        }

		


        document.getElementById("updatePasswordButton").addEventListener("click", () => {
            const password = document.getElementById("password").value.trim();
            const password_check = document.getElementById("password_check").value.trim();

            if (!password ||  !password_check) {
                alert("비밀번호, 비밀번호 확인 모두 입력해 주세요.");
                return;
            }
            
            if (password !== password_check) {
                alert("비밀번호, 비밀번호 확인 값이 같지 않습니다!");
                return;
            }

            fetch("/updatepassword", {
                method: "POST",
                headers: { 'Content-Type': "application/json;charset=utf-8" },
                body: JSON.stringify({ 
                	userid : sessionStorage.getItem("userid"),
                	password : password })
            })
            .then(response => {
                if (!response.ok) {
                    // 실패 처리 (아이디 없음)
                    throw new Error("패스워드 변경이 실패하였습니다");
                }
                return response.text();
            }).then(result =>{
            	if(result === "회원수정 완료"){
            		alert("비밀번호 변경이 완료되었습니다");
            		window.location.href = "/formlogin";
            	}else{
            	      modalText.innerText = error.message;
                      updatepasswordModal.style.display = "block";
            		
            	}
            	
            	
            } )
                        .catch(error => {
                // 실패했을 때
                modalText.innerText = error.message;
                updatepasswordModal.style.display = "block";
            });
            
//             .then(password => {
//                 // 패스워드를 성공적으로 찾았을 때
//                 modalText.innerText = `조회된 비밀번호: ${password}`;
//                 updatepasswordModal.style.display = "block";
//             })
//             .catch(error => {
//                 // 실패했을 때
//                 modalText.innerText = error.message;
//                 updatepasswordModal.style.display = "block";
//             });
            
            
        });
    </script>
        
        
        
        
        
        
        
</body>
</html>
