<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>비밀번호 찾기</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 0;
            padding: 0;
        }
        form {
            max-width: 400px;
            margin: 50px auto;
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        input[type="text"], input[type="email"] {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        button {
            width: 100%;
            padding: 10px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>
    <div th:replace="~{header.html}"></div>
<!--     <form action="/goFindPassword" method="POST"> -->
        <h2>비밀번호 찾기</h2>
        <label for="userid">아이디</label>
        <input type="text" id="userid" name="userid" placeholder="아이디를 입력하세요" required>

		   <label for="userid">이름</label>
        <input type="text" id="name" name="name" placeholder="이름을 입력하세요" required>



        <label for="email">휴대폰 번호</label>
        <input type="phone" id="phone" name="phone" placeholder="휴대폰 번호를 입력하세요 (-제외)" required>

        <button type=button id="findPasswordButton">비밀번호 찾기</button>
<!--     </form> -->

 	<div id="findPasswordModal" style="display:none; position:fixed; top:50%; left:50%; 
    transform:translate(-50%, -50%); background:white; border:1px solid #ccc; 
    border-radius:10px; padding:20px; box-shadow:0 0 10px rgba(0,0,0,0.3); z-index:1000;">
    <p id="modalText">비밀번호 검색 결과가 없습니다.</p>
    <button onclick="closeModal()">닫기</button>
</div>

        <div th:replace="~{footer.html}"></div>
        
        
        
        
           <script>
        const findPasswordModal = document.getElementById("findPasswordModal");
        const modalText = document.getElementById("modalText");

        // 모달 닫기
        function closeModal() {
        	
            findPasswordModal.style.display = "none";
        }

        document.getElementById("findPasswordButton").addEventListener("click", () => {
            const userid = document.getElementById("userid").value.trim();
            const name = document.getElementById("name").value.trim();
            const phone = document.getElementById("phone").value.trim();

            if (!userid||  !name || !phone) {
                alert("아이디와 이름과 휴대폰 번호를 모두 입력해 주세요.");
                return;
            }

            fetch("/findpassword", {
                method: "POST",
                headers: { 'Content-Type': "application/json;charset=utf-8" },
                body: JSON.stringify({ userid: userid, name: name, phone: phone })
            })
            .then(response => {
                if (!response.ok) {
                    // 실패 처리 (아이디 없음)
                    throw new Error("패스워드 조회 결과가 없습니다.");
                }
                return response.text();
            }).then(result =>{
            	if(result === "true"){
            		sessionStorage.setItem("userid", userid);
            		sessionStorage.setItem("name", name);
            		sessionStorage.setItem("phone", phone);
//             		window.location.href = "/updatepassword?userid=${userid}";
//             		 window.location.href = `/updatepassword?userid=${userid}&name=${name}&phone=${phone}`;
            		 window.location.href = "/updatepassword";
            	}else{
            	      modalText.innerText = error.message;
                      findPasswordModal.style.display = "block";
            		
            	}
            	
            	
            } )
                        .catch(error => {
                // 실패했을 때
                modalText.innerText = error.message;
                findPasswordModal.style.display = "block";
            });
            
//             .then(password => {
//                 // 패스워드를 성공적으로 찾았을 때
//                 modalText.innerText = `조회된 비밀번호: ${password}`;
//                 findPasswordModal.style.display = "block";
//             })
//             .catch(error => {
//                 // 실패했을 때
//                 modalText.innerText = error.message;
//                 findPasswordModal.style.display = "block";
//             });
            
            
        });
    </script>
        
        
        
        
        
        
        <script src="js/formatPhoneNumber.js" type="text/javascript"></script>
</body>
</html>
