<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¡œê·¸ì¸</title>
     <link rel="stylesheet" href="/css/loginForm.css">
</head>
<body>
        <div th:replace="~{header.html}"></div>
<!--     <h2>Login</h2> -->
<!--     <form id = "formlogin" action="/formlogin" method="post"> -->
<!--         <label for="username">Username:</label> -->
<!--         <input type="text" id="username" name="userid" required><br> -->
<!--         <label for="password">Password:</label> -->
<!--         <input type="password" id="password" name="password" required><br> -->
<!--         <button type="submit">Login</button> -->
        
<!--         	<a th:href="@{/join}">íšŒì›ê°€ì…</a> <a th:href="@{/findid}">ì•„ì´ë”” ì°¾ê¸°</a> <a -->
<!-- 					th:href="@{/findpassword}">ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°</a> -->
<!--     </form> -->
			<div class="login-container">
<!--         <h2>ë¡œê·¸ì¸</h2> -->
			<div>
			<a href="/" style="display: block; width: 150px; height:150px; margin: 0 auto; margin-bottom:24px;">
  <img src="/logo/logo.jpg" width="150px" height="150px">
</a>

</div>
        <form id="formlogin" action="/formlogin" method="post">
            <label for="username">ì•„ì´ë””</label>
            <input type="text" id="username" name="userid" placeholder="ì•„ì´ë”” ì…ë ¥" required>

            <label for="password">ë¹„ë°€ë²ˆí˜¸</label>
            <input type="password" id="password" name="password" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥" required>

			<input type="checkbox"  id="saveId" style="margin-bottom:15px;"> ì•„ì´ë”” ì €ì¥</input>

            <button type="submit">ë¡œê·¸ì¸</button>

            <div class="links">
                <a th:href="@{/join}">íšŒì›ê°€ì…</a>
                <span> | </span>
                <a th:href="@{/findid}">ì•„ì´ë”” ì°¾ê¸°</a>
                      <span> | </span>
                <a th:href="@{/findpassword}">ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°</a>
            </div>
        </form>
    </div>








        <div th:replace="~{footer.html}"></div>
<!--     	 <th:block th:replace="/footer :: footerFragment"></th:block> -->
</body>




<script>
    document.addEventListener('DOMContentLoaded', () => {
        const savedId = localStorage.getItem('savedId');
        const saveIdChecked = localStorage.getItem('saveIdChecked');

        if (savedId && saveIdChecked === 'true') {
            document.getElementById('username').value = savedId;
            document.getElementById('saveId').checked = true;
        } else {
            document.getElementById('saveId').checked = false;
        }
    });
</script>












	 <script type="module">
	import {loginAlarm} from "/js/alarmModule.js";
	 document.getElementById("formlogin").addEventListener("submit", async (e) => {
		    e.preventDefault(); // ê¸°ë³¸ ì œì¶œ ë°©ì§€

		    const userid = document.getElementById("username").value;
		    const password = document.getElementById("password").value;
				
			  const saveIdCheckbox = document.getElementById('saveId');

		    try {
		        // ğŸ”¹ 1. ë¡œê·¸ì¸ ìš”ì²­
		        const response = await fetch('/validateMember', {
		            method: 'POST',
		            headers: { 'Content-Type': 'application/json' },
		            body: JSON.stringify({ "userid": userid, "password": password })
		        });

		        // ğŸ”¹ 2. ì‘ë‹µ í™•ì¸
		        if (!response.ok) {
		            alert("ë¡œê·¸ì¸ì— ì‹¤íŒ¨í•˜ì˜€ìŠµë‹ˆë‹¤");
		            return;
		        }

		        const responseData = Number(await response.json()); // JSON ë³€í™˜
	if (saveIdCheckbox.checked) {
    localStorage.setItem('savedId', userid);
    localStorage.setItem('saveIdChecked', 'true');  // ì²´í¬ ì—¬ë¶€ ì €ì¥
} else {
    localStorage.removeItem('savedId');
    localStorage.setItem('saveIdChecked', 'false');
}


		        alert("ë¡œê·¸ì¸ì— ì„±ê³µí•˜ì˜€ìŠµë‹ˆë‹¤");

		        
		    //    loginAlarm(responseData);
// 		        // ğŸ”¹ 3. ë¡œê·¸ì¸ ì„±ê³µ ì•ŒëŒ ìš”ì²­
// 		        await fetch(`/alarm/loginSuccess/${responseData}`, {
// 		            method: "POST",
// 		            headers: { 'Content-Type': 'application/json' },
// // 		            credentials: "include", // âœ… ì„¸ì…˜ ìœ ì§€ í•„ìˆ˜
// 		            body: JSON.stringify({ type: "LOGIN" })
// 		        });

		        // ğŸ”¹ 4. í¼ ì œì¶œ
		        e.target.submit(); 

		    } catch (error) {
		        alert("ë¡œê·¸ì¸ ìš”ì²­ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
		    }
		});

    </script>
</html>
