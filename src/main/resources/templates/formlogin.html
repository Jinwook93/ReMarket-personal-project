<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login</title>
</head>
<body>
        <div th:replace="~{header.html}"></div>
    <h2>Login</h2>
    <form id = "formlogin" action="/formlogin" method="post">
        <label for="username">Username:</label>
        <input type="text" id="username" name="userid" required><br>
        <label for="password">Password:</label>
        <input type="password" id="password" name="password" required><br>
        <button type="submit">Login</button>
    </form>
</body>
	 <script type="module">
	import {loginAlarm} from "./js/alarmModule.js";
	 document.getElementById("formlogin").addEventListener("submit", async (e) => {
		    e.preventDefault(); // ê¸°ë³¸ ì œì¶œ ë°©ì§€

		    const userid = document.getElementById("username").value;
		    const password = document.getElementById("password").value;

		    try {
		        // ğŸ”¹ 1. ë¡œê·¸ì¸ ìš”ì²­
		        const response = await fetch('/validateMember', {
		            method: 'POST',
		            headers: { 'Content-Type': 'application/json' },
		            body: JSON.stringify({ "userid": userid, "password": password })
		        });

		        // ğŸ”¹ 2. ì‘ë‹µ í™•ì¸
		        if (!response.ok) {
		            alert("ë¡œê·¸ì¸ì— ì‹¤íŒ¨í•˜ì˜€ìŠµë‹ˆë‹¤");
		            return;
		        }

		        const responseData = Number(await response.json()); // JSON ë³€í™˜

		        alert("ë¡œê·¸ì¸ì— ì„±ê³µí•˜ì˜€ìŠµë‹ˆë‹¤");

		        
		        
		        loginAlarm(responseData);
// 		        // ğŸ”¹ 3. ë¡œê·¸ì¸ ì„±ê³µ ì•ŒëŒ ìš”ì²­
// 		        await fetch(`/alarm/loginSuccess/${responseData}`, {
// 		            method: "POST",
// 		            headers: { 'Content-Type': 'application/json' },
// // 		            credentials: "include", // âœ… ì„¸ì…˜ ìœ ì§€ í•„ìˆ˜
// 		            body: JSON.stringify({ type: "LOGIN" })
// 		        });

		        // ğŸ”¹ 4. í¼ ì œì¶œ
		        e.target.submit(); 

		    } catch (error) {
		        alert("ë¡œê·¸ì¸ ìš”ì²­ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
		    }
		});

    </script>
</html>
